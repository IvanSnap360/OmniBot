<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="omniwheel">

    <xacro:include filename="$(find omnibot_platform_description)/urdf/inertia_calc.xacro"/>

    <xacro:property name="omniwheel_mesh_path"
        value="package://omnibot_platform_description/meshes/wheel.dae" />
        
    <xacro:property name="omniwheel_mesh_scale_x" value="0.001" />
    <xacro:property name="omniwheel_mesh_scale_y" value="0.001" />
    <xacro:property name="omniwheel_mesh_scale_z" value="0.001" />

    <xacro:property name="omniwheel_mass" value="0.5" />
    <xacro:property name="omniwheel_deameter" value="0.15" />
    <xacro:property name="omniwheel_radius" value="${omniwheel_deameter/2}" />
    <xacro:property name="omniwheel_width" value="0.3" />


    <xacro:macro name="omniwheel_macro" params="suffix *origin">


        <link name="${suffix}_omniwheel_link">
            <inertial>
                <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0" />
                <mass value="${omniwheel_mass}" />
                <!-- <inertia ixx="0.0" ixy="0.0" ixz="0.0" iyy="0.0" iyz="0.0" izz="0.0" /> -->
                <xacro:cylinder_inertia m="${omniwheel_mass}" r="${omniwheel_radius}" h="${omniwheel_width}"></xacro:cylinder_inertia>
            </inertial>
            <visual name="">
                <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0" />
                <geometry>
                    <mesh filename="${omniwheel_mesh_path}"
                        scale="${omniwheel_mesh_scale_x} ${omniwheel_mesh_scale_y} ${omniwheel_mesh_scale_z}" />
                </geometry>
                <material name="">
                    <color rgba="1.0 0.0 0.0 1.0" />
                    <texture filename="" />
                </material>
            </visual>
            <collision>
                <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0" />
                <geometry>
                    <mesh filename="${omniwheel_mesh_path}"
                        scale="${omniwheel_mesh_scale_x} ${omniwheel_mesh_scale_y} ${omniwheel_mesh_scale_z}" />
                </geometry>
            </collision>
        </link>

        <transmission name="${suffix}_omniwheel_trans">
            <type>transmission_interface/SimpleTransmission</type>
            <actuator name="${suffix}_omniwheel_motor">
                <mechanicalReduction>1</mechanicalReduction>
            </actuator>
            <joint name="${suffix}_omniwheel_joint">
                <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
            </joint>
        </transmission>

        <joint name="${suffix}_omniwheel_joint" type="revolute">
            <xacro:insert_block name="origin" />
            <parent link="base_link" />
            <child link="${suffix}_omniwheel_link" />
            <axis xyz="0 1 0" />
            <limit lower="-3.14" upper="3.14" effort="1000.0" velocity="50.0" />
        </joint>

        <gazebo reference="${suffix}_omniwheel">
            <mu1 value="200.0" />
            <mu2 value="100.0" />
            <kp value="10000000.0" />
            <kd value="1.0" />
            <material>Gazebo/Grey</material>
        </gazebo>
    </xacro:macro>

</robot>